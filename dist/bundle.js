(()=>{"use strict";function e(e,t,n){const r=n.value;return{configurable:!0,get(){return r.bind(this)}}}var t;!function(e){e.Active="Active",e.Finished="Finished"}(t||(t={}));class n{constructor(e,t,n,r,s){this.id=e,this.title=t,this.description=n,this.people=r,this.status=s}}class r extends class{constructor(){this.listeners=[]}addListener(e){this.listeners.push(e)}}{constructor(){super(),this.projects=[]}static getInstance(){return this.instance||(this.instance=new r),this.instance}addProject(e,r,s){const i=new n(Math.random().toString(),e,r,s,t.Active);this.projects.push(i);for(const e of this.listeners)e(this.projects.slice())}moveProject(e,t){const n=this.projects.find((t=>t.id===e));n&&n.status!==t&&(n.status=t,this.updateListeners())}updateListeners(){for(const e of this.listeners)e(this.projects.slice())}}const s=r.getInstance();class i{constructor(e,t,n,r){this.templateElement=document.getElementById(e),this.hostElement=document.getElementById(t);const s=document.importNode(this.templateElement.content,!0);this.element=s.firstElementChild,r&&(this.element.id=r),this.attach(n)}attach(e){this.hostElement.insertAdjacentElement(e?"afterbegin":"beforeend",this.element)}}class o extends i{constructor(){super("project-input","app",!0,"user-input"),this.configure()}gatherUserInput(){const e=this.titleInputElement.value,t=this.descriptionInputElement.value,n=this.peopleInputElement.value;return[{value:e,required:!0,minLength:3,maxLength:16},{value:t,required:!0,minLength:10,maxLength:1024},{value:+n,required:!0,min:1,max:10}].some((e=>!function(e){let t=!0;return e.required&&(t=t&&e.value.toString().trim().length>0),e.minLength&&"string"==typeof e.value&&(t=t&&e.value.length>=e.minLength),e.maxLength&&"string"==typeof e.value&&(t=t&&e.value.length<=e.maxLength),null!=e.min&&"number"==typeof e.value&&(t=t&&e.value>=e.min),null!=e.max&&"number"==typeof e.value&&(t=t&&e.value<=e.max),t}(e)))?void alert("Title must be minmum 3 or maximum 16 length long.\nTitle must be minmum 10 or maximum 1024 length long.\nNumber of people must be minmum 1 or maximum 10 assigned."):[e,t,+n]}clearInput(){this.titleInputElement.value="",this.descriptionInputElement.value="",this.peopleInputElement.value=""}submitHandler(e){e.preventDefault();const t=this.gatherUserInput();if(Array.isArray(t)){const[e,n,r]=t;s.addProject(e,n,r),this.clearInput()}}configure(){this.titleInputElement=this.element.querySelector("#title"),this.descriptionInputElement=this.element.querySelector("#description"),this.peopleInputElement=this.element.querySelector("#people"),this.element.addEventListener("submit",this.submitHandler)}renderContent(){throw new Error("Method not implemented.")}}!function(e,t,n,r){var s,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(o=(i<3?s(o):i>3?s(t,n,o):s(t,n))||o);i>3&&o&&Object.defineProperty(t,n,o)}([e],o.prototype,"submitHandler",null);var l=function(e,t,n,r){var s,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(o=(i<3?s(o):i>3?s(t,n,o):s(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o};class a extends i{constructor(e,t){super("single-project",e,!1,t.id),this.project=t,this.configure(),this.renderContent()}get persons(){return this.project.people>1?`${this.project.people} persons`:`${this.project.people} person`}dragStartHandler(e){e.dataTransfer.setData("text/plain",this.project.id),e.dataTransfer.effectAllowed="move"}dragEndHandler(e){e.dataTransfer.clearData("text/plain")}configure(){this.element.addEventListener("dragstart",this.dragStartHandler),this.element.addEventListener("dragend",this.dragEndHandler)}renderContent(){this.element.querySelector("h2").textContent=this.project.title,this.element.querySelector("h3").textContent=this.persons+" assigned",this.element.querySelector("p").textContent=this.project.description}}l([e],a.prototype,"dragStartHandler",null),l([e],a.prototype,"dragEndHandler",null);var c=function(e,t,n,r){var s,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(o=(i<3?s(o):i>3?s(t,n,o):s(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o};class d extends i{constructor(e){super("project-list","app",!1,`${e}-projects`),this.type=e,this.configure(),this.renderContent()}dragOverHandler(e){e.dataTransfer&&"text/plain"===e.dataTransfer.types[0]&&(e.preventDefault(),this.element.querySelector("ul").classList.add("droppable"))}dragLeaveHandler(e){this.element.querySelector("ul").classList.remove("droppable")}dropHandler(e){const n=e.dataTransfer.getData("text/plain");s.moveProject(n,"active"===this.type?t.Active:t.Finished)}configure(){this.element.addEventListener("dragover",this.dragOverHandler),this.element.addEventListener("dragleave",this.dragLeaveHandler),this.element.addEventListener("drop",this.dropHandler),s.addListener((e=>{const n=e.filter((e=>"active"===this.type?e.status===t.Active:e.status===t.Finished));this.assignedProjects=n,this.renderProjects()}))}renderProjects(){document.getElementById(`${this.type}-projects-list`).innerHTML="";for(const e of this.assignedProjects)new a(this.element.querySelector("ul").id,e)}renderContent(){const e=`${this.type}-projects-list`;this.element.querySelector("ul").id=e,this.element.querySelector("h2").textContent=this.type.toUpperCase()+" PROJECTS"}}c([e],d.prototype,"dragOverHandler",null),c([e],d.prototype,"dragLeaveHandler",null),c([e],d.prototype,"dropHandler",null),new o,new d("active"),new d("finished")})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90eXBlc2NyaXB0LXByYWN0aWNlLy4vc3JjL0RlY29yYXRvcnMvYXV0by1iaW5kLnRzIiwid2VicGFjazovL3R5cGVzY3JpcHQtcHJhY3RpY2UvLi9zcmMvaW5kZXgudHMiLCJ3ZWJwYWNrOi8vdHlwZXNjcmlwdC1wcmFjdGljZS8uL3NyYy9Nb2RlbHMvcHJvamVjdC50cyIsIndlYnBhY2s6Ly90eXBlc2NyaXB0LXByYWN0aWNlLy4vc3JjL1N0b3Jlcy9Qcm9qZWN0U3RvcmUudHMiLCJ3ZWJwYWNrOi8vdHlwZXNjcmlwdC1wcmFjdGljZS8uL3NyYy9Db21wb25lbnRzL2NvbXBvbmVudC50cyIsIndlYnBhY2s6Ly90eXBlc2NyaXB0LXByYWN0aWNlLy4vc3JjL0NvbXBvbmVudHMvcHJvamVjdC1pbnB1dC50cyIsIndlYnBhY2s6Ly90eXBlc2NyaXB0LXByYWN0aWNlLy4vc3JjL1V0aWxzL3ZhbGlkYXRpb24udHMiLCJ3ZWJwYWNrOi8vdHlwZXNjcmlwdC1wcmFjdGljZS8uL3NyYy9Db21wb25lbnRzL3Byb2plY3QtaXRlbS50cyIsIndlYnBhY2s6Ly90eXBlc2NyaXB0LXByYWN0aWNlLy4vc3JjL0NvbXBvbmVudHMvcHJvamVjdC1saXN0LnRzIiwid2VicGFjazovL3R5cGVzY3JpcHQtcHJhY3RpY2UvLi9zcmMvYXBwLnRzIl0sIm5hbWVzIjpbIkF1dG9CaW5kIiwiXyIsIl8yIiwiZGVzY3JpcHRvciIsIm9yaWdpbmFsTWV0aG9kIiwidmFsdWUiLCJjb25maWd1cmFibGUiLCJnZXQiLCJiaW5kIiwidGhpcyIsIlByb2plY3RTdGF0dXMiLCJQcm9qZWN0IiwiY29uc3RydWN0b3IiLCJpZCIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJwZW9wbGUiLCJzdGF0dXMiLCJQcm9qZWN0U3RvcmUiLCJsaXN0ZW5lcnMiLCJhZGRMaXN0ZW5lciIsImxpc3RlbmVyRm4iLCJwdXNoIiwic3VwZXIiLCJwcm9qZWN0cyIsImluc3RhbmNlIiwiYWRkUHJvamVjdCIsIm5ld1Byb2plY3QiLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJBY3RpdmUiLCJzbGljZSIsIm1vdmVQcm9qZWN0IiwibmV3U3RhdHVzIiwicHJvamVjdCIsImZpbmQiLCJwIiwidXBkYXRlTGlzdGVuZXJzIiwicHJvamVjdFN0b3JlIiwiZ2V0SW5zdGFuY2UiLCJDb21wb25lbnQiLCJ0ZW1wbGF0ZUlkIiwiaG9zdEVsZW1lbnRJZCIsImluc2VydEF0U3RhcnQiLCJuZXdFbGVtZW50SWQiLCJ0ZW1wbGF0ZUVsZW1lbnQiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiaG9zdEVsZW1lbnQiLCJpbXBvcnRlZE5vZGUiLCJpbXBvcnROb2RlIiwiY29udGVudCIsImVsZW1lbnQiLCJmaXJzdEVsZW1lbnRDaGlsZCIsImF0dGFjaCIsImluc2VydEFkamFjZW50RWxlbWVudCIsIlByb2plY3RJbnB1dCIsImNvbmZpZ3VyZSIsImdhdGhlclVzZXJJbnB1dCIsImVudGVyZWRUaXRsZSIsInRpdGxlSW5wdXRFbGVtZW50IiwiZW50ZXJlZERlc2NyaXB0aW9uIiwiZGVzY3JpcHRpb25JbnB1dEVsZW1lbnQiLCJlbnRlcmVkUGVvcGxlIiwicGVvcGxlSW5wdXRFbGVtZW50IiwicmVxdWlyZWQiLCJtaW5MZW5ndGgiLCJtYXhMZW5ndGgiLCJtaW4iLCJtYXgiLCJzb21lIiwidmFsaWRhdGFibGUiLCJpbnB1dCIsImlzVmFsaWQiLCJ0cmltIiwibGVuZ3RoIiwidmFsaWRhdGUiLCJhbGVydCIsImNsZWFySW5wdXQiLCJzdWJtaXRIYW5kbGVyIiwiZXZlbnQiLCJwcmV2ZW50RGVmYXVsdCIsInVzZXJJbnB1dCIsIkFycmF5IiwiaXNBcnJheSIsInF1ZXJ5U2VsZWN0b3IiLCJhZGRFdmVudExpc3RlbmVyIiwicmVuZGVyQ29udGVudCIsIkVycm9yIiwiUHJvamVjdEl0ZW0iLCJob3N0SWQiLCJkcmFnU3RhcnRIYW5kbGVyIiwiZGF0YVRyYW5zZmVyIiwic2V0RGF0YSIsImVmZmVjdEFsbG93ZWQiLCJkcmFnRW5kSGFuZGxlciIsImNsZWFyRGF0YSIsInRleHRDb250ZW50IiwicGVyc29ucyIsIlByb2plY3RMaXN0IiwidHlwZSIsImRyYWdPdmVySGFuZGxlciIsInR5cGVzIiwiY2xhc3NMaXN0IiwiYWRkIiwiZHJhZ0xlYXZlSGFuZGxlciIsIl9ldmVudCIsInJlbW92ZSIsImRyb3BIYW5kbGVyIiwicHJqSWQiLCJnZXREYXRhIiwiRmluaXNoZWQiLCJyZWxldmVudFByb2plY3RzIiwiZmlsdGVyIiwicHJqIiwiYXNzaWduZWRQcm9qZWN0cyIsInJlbmRlclByb2plY3RzIiwiaW5uZXJIVE1MIiwibGlzdElkIiwidG9VcHBlckNhc2UiXSwibWFwcGluZ3MiOiJtQkFBTyxTQUFTQSxFQUFTQyxFQUFRQyxFQUFZQyxHQUN6QyxNQUFNQyxFQUFpQkQsRUFBV0UsTUFRbEMsTUFQMEMsQ0FDdENDLGNBQWMsRUFDZEMsTUFFSSxPQURnQkgsRUFBZUksS0FBS0MsUUNNaEQsSUFBWUMsR0FBWixTQUFZQSxHQUNSLGtCQUFtQixzQkFEdkIsQ0FBWUEsTUFBYSxLQ1RsQixNQUFNQyxFQUVUQyxZQUNXQyxFQUNBQyxFQUNBQyxFQUNBQyxFQUNBQyxHQUpBLEtBQUFKLEtBQ0EsS0FBQUMsUUFDQSxLQUFBQyxjQUNBLEtBQUFDLFNBQ0EsS0FBQUMsVUNFUixNQUFNQyxVQVJOLE1BQVAsY0FDYyxLQUFBQyxVQUEyQixHQUVyQ0MsWUFBWUMsR0FDUlosS0FBS1UsVUFBVUcsS0FBS0QsS0FReEIsY0FDSUUsUUFKSSxLQUFBQyxTQUFzQixHQU85QixxQkFDSSxPQUFJZixLQUFLZ0IsV0FHVGhCLEtBQUtnQixTQUFXLElBQUlQLEdBRlRULEtBQUtnQixTQU1wQkMsV0FBV1osRUFBZUMsRUFBcUJDLEdBQzNDLE1BQU1XLEVBQWEsSUFBSWhCLEVBQ2ZpQixLQUFLQyxTQUFTQyxXQUNkaEIsRUFBT0MsRUFBYUMsRUFDcEJOLEVBQWNxQixRQUV0QnRCLEtBQUtlLFNBQVNGLEtBQUtLLEdBRW5CLElBQUssTUFBTU4sS0FBY1osS0FB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QVksVUFDaEIsSUFBSUEsRUFBWSxhIiwiZmlsZSI6ImJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBmdW5jdGlvbiBBdXRvQmluZChfOiBhbnksIF8yOiBzdHJpbmcsIGRlc2NyaXB0b3I6IFByb3BlcnR5RGVzY3JpcHRvcikge1xyXG4gICAgY29uc3Qgb3JpZ2luYWxNZXRob2QgPSBkZXNjcmlwdG9yLnZhbHVlO1xyXG4gICAgY29uc3QgYWRqRGVzY3JpcHRvcjogUHJvcGVydHlEZXNjcmlwdG9yID0ge1xyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcclxuICAgICAgICBnZXQoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGJvdW5kRm4gPSBvcmlnaW5hbE1ldGhvZC5iaW5kKHRoaXMpO1xyXG4gICAgICAgICAgICByZXR1cm4gYm91bmRGbjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYWRqRGVzY3JpcHRvcjtcclxufSIsImV4cG9ydCBpbnRlcmZhY2UgRHJhZ2dhYmxlIHtcclxuICAgIGRyYWdTdGFydEhhbmRsZXIoZXZlbnQ6IERyYWdFdmVudCk6IHZvaWQ7XHJcbiAgICBkcmFnRW5kSGFuZGxlcihldmVudDogRHJhZ0V2ZW50KTogdm9pZDtcclxufVxyXG4gICAgXHJcbmV4cG9ydCBpbnRlcmZhY2UgRHJhZ1RhcmdldCB7XHJcbiAgICBkcmFnT3ZlckhhbmRsZXIoZXZlbnQ6IERyYWdFdmVudCk6IHZvaWQ7XHJcbiAgICBkcm9wSGFuZGxlcihldmVudDogRHJhZ0V2ZW50KTogdm9pZDtcclxuICAgIGRyYWdMZWF2ZUhhbmRsZXIoZXZlbnQ6IERyYWdFdmVudCk6IHZvaWQ7XHJcbn1cclxuXHJcbmV4cG9ydCBlbnVtIFByb2plY3RTdGF0dXMge1xyXG4gICAgQWN0aXZlID0gJ0FjdGl2ZScsIEZpbmlzaGVkID0gJ0ZpbmlzaGVkJ1xyXG59XHJcbiAgICBcclxuZXhwb3J0IHR5cGUgTGlzdGVuZXI8VD4gPSAoaXRlbXM6IFRbXSkgPT4gdm9pZDtcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgVmFsaWRhdGFibGUge1xyXG4gICAgdmFsdWU6IHN0cmluZyB8IG51bWJlcjtcclxuICAgIHJlcXVpcmVkPzogYm9vbGVhbjtcclxuICAgIG1pbkxlbmd0aD86IG51bWJlcjtcclxuICAgIG1heExlbmd0aD86IG51bWJlcjtcclxuICAgIG1pbj86IG51bWJlcjtcclxuICAgIG1heD86IG51bWJlcjtcclxufSIsImltcG9ydCB7IFByb2plY3RTdGF0dXMgfSBmcm9tIFwiLi4vaW5kZXhcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBQcm9qZWN0XHJcbntcclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHB1YmxpYyBpZDogc3RyaW5nLFxyXG4gICAgICAgIHB1YmxpYyB0aXRsZTogc3RyaW5nLFxyXG4gICAgICAgIHB1YmxpYyBkZXNjcmlwdGlvbjogc3RyaW5nLFxyXG4gICAgICAgIHB1YmxpYyBwZW9wbGU6IG51bWJlcixcclxuICAgICAgICBwdWJsaWMgc3RhdHVzOiBQcm9qZWN0U3RhdHVzLFxyXG4gICAgKVxyXG4gICAge1xyXG5cclxuICAgIH1cclxufVxyXG4iLCJpbXBvcnQgeyBMaXN0ZW5lciwgUHJvamVjdFN0YXR1cyB9IGZyb20gXCIuLi9pbmRleFwiO1xyXG5pbXBvcnQgeyBQcm9qZWN0IH0gZnJvbSBcIi4uL01vZGVscy9wcm9qZWN0XCI7XHJcblxyXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgU3RvcmU8VD4ge1xyXG4gICAgcHJvdGVjdGVkIGxpc3RlbmVyczogTGlzdGVuZXI8VD5bXSA9IFtdO1xyXG5cclxuICAgIGFkZExpc3RlbmVyKGxpc3RlbmVyRm46IExpc3RlbmVyPFQ+KSB7XHJcbiAgICAgICAgdGhpcy5saXN0ZW5lcnMucHVzaChsaXN0ZW5lckZuKTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIFByb2plY3RTdG9yZSBleHRlbmRzIFN0b3JlPFByb2plY3Q+IHtcclxuICAgIHByaXZhdGUgcHJvamVjdHM6IFByb2plY3RbXSA9IFtdO1xyXG4gICAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IFByb2plY3RTdG9yZTtcclxuXHJcbiAgICBwcml2YXRlIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHN1cGVyKCk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGdldEluc3RhbmNlKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmluc3RhbmNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmluc3RhbmNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmluc3RhbmNlID0gbmV3IFByb2plY3RTdG9yZSgpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmluc3RhbmNlO1xyXG4gICAgfVxyXG5cclxuICAgIGFkZFByb2plY3QodGl0bGU6IHN0cmluZywgZGVzY3JpcHRpb246IHN0cmluZywgcGVvcGxlOiBudW1iZXIpIHtcclxuICAgICAgICBjb25zdCBuZXdQcm9qZWN0ID0gbmV3IFByb2plY3QoXHJcbiAgICAgICAgICAgICAgICBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKCksXHJcbiAgICAgICAgICAgICAgICB0aXRsZSwgZGVzY3JpcHRpb24sIHBlb3BsZSxcclxuICAgICAgICAgICAgICAgIFByb2plY3RTdGF0dXMuQWN0aXZlLFxyXG4gICAgICAgIClcclxuICAgICAgICB0aGlzLnByb2plY3RzLnB1c2gobmV3UHJvamVjdCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgZm9yIChjb25zdCBsaXN0ZW5lckZuIG9mIHRoaXMubGlzdGVuZXJzKSB7XHJcbiAgICAgICAgICAgIGxpc3RlbmVyRm4odGhpcy5wcm9qZWN0cy5zbGljZSgpKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbW92ZVByb2plY3QoaWQ6IHN0cmluZywgbmV3U3RhdHVzOiBQcm9qZWN0U3RhdHVzKSB7XHJcbiAgICBjb25zdCBwcm9qZWN0ID0gdGhpcy5wcm9qZWN0cy5maW5kKHAgPT4gcC5pZCA9PT0gaWQpO1xyXG4gICAgaWYgKHByb2plY3QgJiYgKHByb2plY3Quc3RhdHVzICE9PSBuZXdTdGF0dXMpKSB7XHJcbiAgICAgICAgcHJvamVjdC5zdGF0dXMgPSBuZXdTdGF0dXM7XHJcbiAgICAgICAgdGhpcy51cGRhdGVMaXN0ZW5lcnMoKTtcclxuICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHVwZGF0ZUxpc3RlbmVycygpIHtcclxuICAgICAgICBmb3IgKGNvbnN0IGxpc3RlbmVyRm4gb2YgdGhpcy5saXN0ZW5lcnMpIHtcclxuICAgICAgICAgICAgbGlzdGVuZXJGbih0aGlzLnByb2plY3RzLnNsaWNlKCkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IHByb2plY3RTdG9yZSA9IFByb2plY3RTdG9yZS5nZXRJbnN0YW5jZSgpOyIsImV4cG9ydCBhYnN0cmFjdCBjbGFzcyBDb21wb25lbnQ8VCBleHRlbmRzIEhUTUxFbGVtZW50LCBVIGV4dGVuZHMgSFRNTEVsZW1lbnQ+IHtcclxuICAgIHRlbXBsYXRlRWxlbWVudDogSFRNTFRlbXBsYXRlRWxlbWVudDtcclxuICAgIGhvc3RFbGVtZW50OiBUO1xyXG4gICAgZWxlbWVudDogVTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICB0ZW1wbGF0ZUlkOiBzdHJpbmcsXHJcbiAgICAgICAgaG9zdEVsZW1lbnRJZDogc3RyaW5nLFxyXG4gICAgICAgIGluc2VydEF0U3RhcnQ6IGJvb2xlYW4sXHJcbiAgICAgICAgbmV3RWxlbWVudElkPzogc3RyaW5nLFxyXG4gICAgICAgICkge1xyXG4gICAgICAgIHRoaXMudGVtcGxhdGVFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGVtcGxhdGVJZCkhIGFzIEhUTUxUZW1wbGF0ZUVsZW1lbnQ7XHJcbiAgICAgICAgdGhpcy5ob3N0RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGhvc3RFbGVtZW50SWQpISBhcyBUO1xyXG5cclxuICAgICAgICBjb25zdCBpbXBvcnRlZE5vZGUgPSBkb2N1bWVudC5pbXBvcnROb2RlKHRoaXMudGVtcGxhdGVFbGVtZW50LmNvbnRlbnQsIHRydWUpO1xyXG4gICAgICAgIHRoaXMuZWxlbWVudCA9IGltcG9ydGVkTm9kZS5maXJzdEVsZW1lbnRDaGlsZCBhcyBVO1xyXG4gICAgICAgIGlmIChuZXdFbGVtZW50SWQpXHJcbiAgICAgICAgdGhpcy5lbGVtZW50LmlkID0gbmV3RWxlbWVudElkO1xyXG5cclxuICAgICAgICB0aGlzLmF0dGFjaChpbnNlcnRBdFN0YXJ0KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGF0dGFjaChpbnNlcnRBdFN0YXJ0OiBib29sZWFuKSB7XHJcbiAgICAgICAgdGhpcy5ob3N0RWxlbWVudC5pbnNlcnRBZGphY2VudEVsZW1lbnQoIGluc2VydEF0U3RhcnQgPyAgJ2FmdGVyYmVnaW4nIDogJ2JlZm9yZWVuZCcsIHRoaXMuZWxlbWVudCk7XHJcbiAgICB9XHJcblxyXG4gICAgYWJzdHJhY3QgY29uZmlndXJlKCk6IHZvaWQ7XHJcbiAgICBhYnN0cmFjdCByZW5kZXJDb250ZW50KCk6IHZvaWQ7XHJcbn1cclxuIiwiaW1wb3J0IHsgQXV0b0JpbmQgfSBmcm9tIFwiLi4vRGVjb3JhdG9ycy9hdXRvLWJpbmRcIjtcclxuaW1wb3J0IHsgVmFsaWRhdGFibGUgfSBmcm9tIFwiLi4vaW5kZXhcIjtcclxuaW1wb3J0IHsgcHJvamVjdFN0b3JlIH0gZnJvbSBcIi4uL1N0b3Jlcy9Qcm9qZWN0U3RvcmVcIjtcclxuaW1wb3J0IHsgdmFsaWRhdGUgfSBmcm9tIFwiLi4vVXRpbHMvdmFsaWRhdGlvblwiO1xyXG5pbXBvcnQgeyBDb21wb25lbnQgfSBmcm9tIFwiLi9jb21wb25lbnRcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBQcm9qZWN0SW5wdXQgZXh0ZW5kcyBDb21wb25lbnQgPEhUTUxEaXZFbGVtZW50LCBIVE1MRWxlbWVudD4ge1xyXG4gICAgdGl0bGVJbnB1dEVsZW1lbnQhOiBIVE1MSW5wdXRFbGVtZW50O1xyXG4gICAgZGVzY3JpcHRpb25JbnB1dEVsZW1lbnQhOiBIVE1MSW5wdXRFbGVtZW50O1xyXG4gICAgcGVvcGxlSW5wdXRFbGVtZW50ITogSFRNTElucHV0RWxlbWVudDtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICBzdXBlcigncHJvamVjdC1pbnB1dCcsICdhcHAnLCB0cnVlLCAndXNlci1pbnB1dCcpO1xyXG5cclxuICAgICAgICB0aGlzLmNvbmZpZ3VyZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2F0aGVyVXNlcklucHV0KCk6IFtzdHJpbmcsIHN0cmluZywgbnVtYmVyXSB8IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IGVudGVyZWRUaXRsZSA9IHRoaXMudGl0bGVJbnB1dEVsZW1lbnQudmFsdWU7XHJcbiAgICAgICAgY29uc3QgZW50ZXJlZERlc2NyaXB0aW9uID0gdGhpcy5kZXNjcmlwdGlvbklucHV0RWxlbWVudC52YWx1ZTtcclxuICAgICAgICBjb25zdCBlbnRlcmVkUGVvcGxlID0gdGhpcy5wZW9wbGVJbnB1dEVsZW1lbnQudmFsdWU7XHJcblxyXG4gICAgICAgIGNvbnN0IHRpdGxlVmFsaWRhdGFibGU6IFZhbGlkYXRhYmxlID0ge1xyXG4gICAgICAgICAgICB2YWx1ZTogZW50ZXJlZFRpdGxlLFxyXG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcclxuICAgICAgICAgICAgbWluTGVuZ3RoOiAzLFxyXG4gICAgICAgICAgICBtYXhMZW5ndGg6IDE2LFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgZGVzY3JpcHRpb25WYWxpZGF0YWJsZTogVmFsaWRhdGFibGUgPSB7XHJcbiAgICAgICAgICAgIHZhbHVlOiBlbnRlcmVkRGVzY3JpcHRpb24sXHJcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxyXG4gICAgICAgICAgICBtaW5MZW5ndGg6IDEwLFxyXG4gICAgICAgICAgICBtYXhMZW5ndGg6IDEwMjQsXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBwZW9wbGVWYWxpZGF0YWJsZTogVmFsaWRhdGFibGUgPSB7XHJcbiAgICAgICAgICAgIHZhbHVlOiArZW50ZXJlZFBlb3BsZSxcclxuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXHJcbiAgICAgICAgICAgIG1pbjogMSxcclxuICAgICAgICAgICAgbWF4OiAxMCxcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKFt0aXRsZVZhbGlkYXRhYmxlLCBkZXNjcmlwdGlvblZhbGlkYXRhYmxlLCBwZW9wbGVWYWxpZGF0YWJsZV0uc29tZSh2YWxpZGF0YWJsZSA9PiAhdmFsaWRhdGUodmFsaWRhdGFibGUpKSkge1xyXG4gICAgICAgICAgICBhbGVydCgnVGl0bGUgbXVzdCBiZSBtaW5tdW0gMyBvciBtYXhpbXVtIDE2IGxlbmd0aCBsb25nLlxcblRpdGxlIG11c3QgYmUgbWlubXVtIDEwIG9yIG1heGltdW0gMTAyNCBsZW5ndGggbG9uZy5cXG5OdW1iZXIgb2YgcGVvcGxlIG11c3QgYmUgbWlubXVtIDEgb3IgbWF4aW11bSAxMCBhc3NpZ25lZC4nKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBbZW50ZXJlZFRpdGxlLCBlbnRlcmVkRGVzY3JpcHRpb24sICtlbnRlcmVkUGVvcGxlXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY2xlYXJJbnB1dCgpIHtcclxuICAgICAgICB0aGlzLnRpdGxlSW5wdXRFbGVtZW50LnZhbHVlID0gJyc7XHJcbiAgICAgICAgdGhpcy5kZXNjcmlwdGlvbklucHV0RWxlbWVudC52YWx1ZSA9ICcnO1xyXG4gICAgICAgIHRoaXMucGVvcGxlSW5wdXRFbGVtZW50LnZhbHVlID0gJyc7XHJcbiAgICB9XHJcblxyXG4gICAgQEF1dG9CaW5kXHJcbiAgICBwcml2YXRlIHN1Ym1pdEhhbmRsZXIoZXZlbnQ6IEV2ZW50KSB7XHJcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICBjb25zdCB1c2VySW5wdXQgPSB0aGlzLmdhdGhlclVzZXJJbnB1dCgpITtcclxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh1c2VySW5wdXQpKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IFt0aXRsZSwgZGVzY3JpcHRpb24sIHBlb3BsZV0gPSB1c2VySW5wdXQ7XHJcbiAgICAgICAgICAgIHByb2plY3RTdG9yZS5hZGRQcm9qZWN0KHRpdGxlLCBkZXNjcmlwdGlvbiwgcGVvcGxlKTtcclxuICAgICAgICAgICAgdGhpcy5jbGVhcklucHV0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbmZpZ3VyZSgpIHtcclxuICAgICAgICB0aGlzLnRpdGxlSW5wdXRFbGVtZW50ID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJyN0aXRsZScpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XHJcbiAgICAgICAgdGhpcy5kZXNjcmlwdGlvbklucHV0RWxlbWVudCA9IHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcjZGVzY3JpcHRpb24nKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xyXG4gICAgICAgIHRoaXMucGVvcGxlSW5wdXRFbGVtZW50ID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwZW9wbGUnKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xyXG5cclxuICAgICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgdGhpcy5zdWJtaXRIYW5kbGVyKTtcclxuICAgIH1cclxuXHJcbiAgICByZW5kZXJDb250ZW50KCk6IHZvaWRcclxuICAgIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNZXRob2Qgbm90IGltcGxlbWVudGVkLlwiKTtcclxuICAgIH1cclxufSIsImltcG9ydCB7IFZhbGlkYXRhYmxlIH0gZnJvbSBcIi4uL2luZGV4XCI7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGUoaW5wdXQ6IFZhbGlkYXRhYmxlKSB7XHJcbiAgICBsZXQgaXNWYWxpZCA9IHRydWU7XHJcbiAgICBpZiAoaW5wdXQucmVxdWlyZWQpIHtcclxuICAgICAgICBpc1ZhbGlkID0gaXNWYWxpZCAmJiBpbnB1dC52YWx1ZS50b1N0cmluZygpLnRyaW0oKS5sZW5ndGggPiAwO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChpbnB1dC5taW5MZW5ndGggJiYgKHR5cGVvZiBpbnB1dC52YWx1ZSA9PT0gJ3N0cmluZycpKSB7XHJcbiAgICAgICAgaXNWYWxpZCA9IGlzVmFsaWQgJiYgaW5wdXQudmFsdWUubGVuZ3RoID49IGlucHV0Lm1pbkxlbmd0aDtcclxuICAgIH1cclxuICAgIFxyXG4gICAgaWYgKGlucHV0Lm1heExlbmd0aCAmJiAodHlwZW9mIGlucHV0LnZhbHVlID09PSAnc3RyaW5nJykpIHtcclxuICAgICAgICBpc1ZhbGlkID0gaXNWYWxpZCAmJiBpbnB1dC52YWx1ZS5sZW5ndGggPD0gaW5wdXQubWF4TGVuZ3RoO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICgoaW5wdXQubWluICE9IG51bGwpICYmICh0eXBlb2YgaW5wdXQudmFsdWUgPT09ICdudW1iZXInKSkge1xyXG4gICAgICAgIGlzVmFsaWQgPSBpc1ZhbGlkICYmIGlucHV0LnZhbHVlID49IGlucHV0Lm1pbjtcclxuICAgIH1cclxuICAgIFxyXG4gICAgaWYgKChpbnB1dC5tYXggIT0gbnVsbCkgJiYgKHR5cGVvZiBpbnB1dC52YWx1ZSA9PT0gJ251bWJlcicpKSB7XHJcbiAgICAgICAgaXNWYWxpZCA9IGlzVmFsaWQgJiYgaW5wdXQudmFsdWUgPD0gaW5wdXQubWF4O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGlzVmFsaWQ7XHJcbn0iLCJpbXBvcnQgeyBBdXRvQmluZCB9IGZyb20gXCIuLi9EZWNvcmF0b3JzL2F1dG8tYmluZFwiO1xyXG5pbXBvcnQgeyBEcmFnZ2FibGUgfSBmcm9tIFwiLi4vaW5kZXhcIjtcclxuaW1wb3J0IHsgUHJvamVjdCB9IGZyb20gXCIuLi9Nb2RlbHMvcHJvamVjdFwiO1xyXG5pbXBvcnQgeyBDb21wb25lbnQgfSBmcm9tIFwiLi9jb21wb25lbnRcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBQcm9qZWN0SXRlbSBleHRlbmRzIENvbXBvbmVudCA8SFRNTFVMaXN0RWxlbWVudCwgSFRNTExJRWxlbWVudD4gaW1wbGVtZW50cyBEcmFnZ2FibGUge1xyXG4gICAgcHJpdmF0ZSBwcm9qZWN0OiBQcm9qZWN0O1xyXG5cclxuICAgIGdldCBwZXJzb25zKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnByb2plY3QucGVvcGxlID4gMSA/IGAke3RoaXMucHJvamVjdC5wZW9wbGV9IHBlcnNvbnNgIDogYCR7dGhpcy5wcm9qZWN0LnBlb3BsZX0gcGVyc29uYFxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0cnVjdG9yKGhvc3RJZDogc3RyaW5nLCBwcm9qZWN0OiBQcm9qZWN0KSB7XHJcbiAgICAgICAgc3VwZXIoJ3NpbmdsZS1wcm9qZWN0JywgaG9zdElkLCBmYWxzZSwgcHJvamVjdC5pZCk7XHJcbiAgICAgICAgdGhpcy5wcm9qZWN0ID0gcHJvamVjdDtcclxuXHJcbiAgICAgICAgdGhpcy5jb25maWd1cmUoKTtcclxuICAgICAgICB0aGlzLnJlbmRlckNvbnRlbnQoKTtcclxuICAgIH1cclxuXHJcbiAgICBAQXV0b0JpbmRcclxuICAgIGRyYWdTdGFydEhhbmRsZXIoZXZlbnQ6IERyYWdFdmVudCkge1xyXG4gICAgICAgIGV2ZW50LmRhdGFUcmFuc2ZlciEuc2V0RGF0YSgndGV4dC9wbGFpbicsIHRoaXMucHJvamVjdC5pZCk7XHJcbiAgICAgICAgZXZlbnQuZGF0YVRyYW5zZmVyIS5lZmZlY3RBbGxvd2VkID0gJ21vdmUnOyAgICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgQEF1dG9CaW5kXHJcbiAgICBkcmFnRW5kSGFuZGxlcihldmVudDogRHJhZ0V2ZW50KSB7XHJcbiAgICAgICAgZXZlbnQuZGF0YVRyYW5zZmVyIS5jbGVhckRhdGEoJ3RleHQvcGxhaW4nKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25maWd1cmUoKSB7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdzdGFydCcsIHRoaXMuZHJhZ1N0YXJ0SGFuZGxlcik7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdlbmQnLCB0aGlzLmRyYWdFbmRIYW5kbGVyKTtcclxuICAgIH1cclxuXHJcbiAgICByZW5kZXJDb250ZW50KCkge1xyXG4gICAgICAgIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCdoMicpIS50ZXh0Q29udGVudCA9IHRoaXMucHJvamVjdC50aXRsZTtcclxuICAgICAgICB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcignaDMnKSEudGV4dENvbnRlbnQgPSB0aGlzLnBlcnNvbnMgKyAnIGFzc2lnbmVkJztcclxuICAgICAgICB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcigncCcpIS50ZXh0Q29udGVudCA9IHRoaXMucHJvamVjdC5kZXNjcmlwdGlvbjtcclxuICAgIH1cclxufSAgICAiLCJpbXBvcnQgeyBBdXRvQmluZCB9IGZyb20gXCIuLi9EZWNvcmF0b3JzL2F1dG8tYmluZFwiO1xyXG5pbXBvcnQgeyBEcmFnVGFyZ2V0LCBQcm9qZWN0U3RhdHVzIH0gZnJvbSBcIi4uL2luZGV4XCI7XHJcbmltcG9ydCB7IFByb2plY3QgfSBmcm9tIFwiLi4vTW9kZWxzL3Byb2plY3RcIjtcclxuaW1wb3J0IHsgcHJvamVjdFN0b3JlIH0gZnJvbSBcIi4uL1N0b3Jlcy9Qcm9qZWN0U3RvcmVcIjtcclxuaW1wb3J0IHsgQ29tcG9uZW50IH0gZnJvbSBcIi4vY29tcG9uZW50XCI7XHJcbmltcG9ydCB7IFByb2plY3RJdGVtIH0gZnJvbSBcIi4vcHJvamVjdC1pdGVtXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgUHJvamVjdExpc3QgZXh0ZW5kcyBDb21wb25lbnQ8SFRNTERpdkVsZW1lbnQsIEhUTUxFbGVtZW50PiBpbXBsZW1lbnRzIERyYWdUYXJnZXQge1xyXG4gICAgYXNzaWduZWRQcm9qZWN0cyE6IFByb2plY3RbXTtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHR5cGU6ICdhY3RpdmUnIHwgJ2ZpbmlzaGVkJykge1xyXG4gICAgICAgIHN1cGVyKCdwcm9qZWN0LWxpc3QnLCBgYXBwYCwgZmFsc2UsIGAke3R5cGV9LXByb2plY3RzYCApO1xyXG5cclxuICAgICAgICB0aGlzLmNvbmZpZ3VyZSgpXHJcbiAgICAgICAgdGhpcy5yZW5kZXJDb250ZW50KCk7XHJcbiAgICB9XHJcblxyXG4gICAgQEF1dG9CaW5kXHJcbiAgICBkcmFnT3ZlckhhbmRsZXIoZXZlbnQ6IERyYWdFdmVudCkge1xyXG4gICAgICAgIGlmIChldmVudC5kYXRhVHJhbnNmZXIgJiYgZXZlbnQuZGF0YVRyYW5zZmVyLnR5cGVzWzBdID09PSAndGV4dC9wbGFpbicpIHtcclxuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsgICBcclxuICAgICAgICAgICAgY29uc3QgbGlzdEVsID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ3VsJykhO1xyXG4gICAgICAgICAgICBsaXN0RWwuY2xhc3NMaXN0LmFkZCgnZHJvcHBhYmxlJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIEBBdXRvQmluZFxyXG4gICAgZHJhZ0xlYXZlSGFuZGxlcihfZXZlbnQ6IERyYWdFdmVudCkge1xyXG4gICAgICAgIGNvbnN0IGxpc3RFbCA9IHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCd1bCcpITtcclxuICAgICAgICBsaXN0RWwuY2xhc3NMaXN0LnJlbW92ZSgnZHJvcHBhYmxlJyk7XHJcbiAgICB9XHJcblxyXG4gICAgQEF1dG9CaW5kXHJcbiAgICBkcm9wSGFuZGxlcihldmVudDogRHJhZ0V2ZW50KSB7XHJcbiAgICAgICAgY29uc3QgcHJqSWQgPSBldmVudC5kYXRhVHJhbnNmZXIhLmdldERhdGEoJ3RleHQvcGxhaW4nKTtcclxuICAgICAgICBwcm9qZWN0U3RvcmUubW92ZVByb2plY3QocHJqSWQsIHRoaXMudHlwZSA9PT0gJ2FjdGl2ZScgPyBQcm9qZWN0U3RhdHVzLkFjdGl2ZSA6IFByb2plY3RTdGF0dXMuRmluaXNoZWQpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbmZpZ3VyZSgpIHtcclxuICAgICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ292ZXInLCB0aGlzLmRyYWdPdmVySGFuZGxlcik7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdsZWF2ZScsIHRoaXMuZHJhZ0xlYXZlSGFuZGxlcik7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2Ryb3AnLCB0aGlzLmRyb3BIYW5kbGVyKTtcclxuICAgICAgICBcclxuICAgICAgICBwcm9qZWN0U3RvcmUuYWRkTGlzdGVuZXIoKHByb2plY3RzOiBQcm9qZWN0W10pID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcmVsZXZlbnRQcm9qZWN0cyA9IHByb2plY3RzLmZpbHRlcihwcmogPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudHlwZSA9PT0gJ2FjdGl2ZScgPyBwcmouc3RhdHVzID09PSBQcm9qZWN0U3RhdHVzLkFjdGl2ZSA6IHByai5zdGF0dXMgPT09IFByb2plY3RTdGF0dXMuRmluaXNoZWQ7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIHRoaXMuYXNzaWduZWRQcm9qZWN0cyA9IHJlbGV2ZW50UHJvamVjdHM7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyUHJvamVjdHMoKTtcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcmVuZGVyUHJvamVjdHMoKSB7XHJcbiAgICAgICAgY29uc3QgbGlzdEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgJHt0aGlzLnR5cGV9LXByb2plY3RzLWxpc3RgKSEgYXMgSFRNTFVMaXN0RWxlbWVudDtcclxuXHJcbiAgICAgICAgbGlzdEVsZW1lbnQuaW5uZXJIVE1MID0gJyc7XHJcbiAgICAgICAgZm9yIChjb25zdCBwcm9qZWN0IG9mIHRoaXMuYXNzaWduZWRQcm9qZWN0cykge1xyXG4gICAgICAgICAgICBuZXcgUHJvamVjdEl0ZW0odGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ3VsJykhLmlkLCBwcm9qZWN0KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHJlbmRlckNvbnRlbnQoKSB7XHJcbiAgICAgICAgY29uc3QgbGlzdElkID0gYCR7dGhpcy50eXBlfS1wcm9qZWN0cy1saXN0YDtcclxuICAgICAgICB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcigndWwnKSEuaWQgPSBsaXN0SWQ7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2gyJykhLnRleHRDb250ZW50ID0gdGhpcy50eXBlLnRvVXBwZXJDYXNlKCkgKyAnIFBST0pFQ1RTJztcclxuICAgIH1cclxufSIsImltcG9ydCB7IFByb2plY3RJbnB1dCB9IGZyb20gXCIuL0NvbXBvbmVudHMvcHJvamVjdC1pbnB1dFwiO1xyXG5pbXBvcnQgeyBQcm9qZWN0TGlzdCB9IGZyb20gXCIuL0NvbXBvbmVudHMvcHJvamVjdC1saXN0XCI7XHJcblxyXG5uZXcgUHJvamVjdElucHV0KCk7XHJcbm5ldyBQcm9qZWN0TGlzdCgnYWN0aXZlJyk7XHJcbm5ldyBQcm9qZWN0TGlzdCgnZmluaXNoZWQnKTsiXSwic291cmNlUm9vdCI6IiJ9